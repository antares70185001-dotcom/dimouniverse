<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>디모 발명 카드</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Jua&family=Orbitron:wght@700;900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@700;800&display=swap" rel="stylesheet">
  <style>
    :root { 
      --main:#5cab6d;
      --accent:#a5e6b8;
      --bg:#f8fff9;
    }
    body { font-family:"Arial",sans-serif; background:var(--bg); text-align:center; margin:0; padding:20px; }
    .screen { display:none; } 
    .active { display:block; }
    video { width:780px; max-width:100%; border-radius:20px; margin:20px auto; display:block; box-shadow:0 12px 40px rgba(0,0,0,0.3); }
    
    .title { 
      font-family:'Jua', sans-serif; 
      font-size:58px; 
      font-weight:bold; 
      margin:15px 0; 
      color:var(--main); 
      text-shadow:2px 2px 6px rgba(0,0,0,0.2);
    }
    .start-btn{ margin:20px auto; background:var(--accent); border:none; padding:14px 32px; border-radius:30px; cursor:pointer; font-size:20px; font-weight:bold; color:#2d4d38; transition:all .3s ease; display:inline-block; box-shadow:0 6px 14px rgba(0,0,0,0.15);}
    .start-btn:hover{ background:#8ed8a3; transform:scale(1.05); }
  </style>
</head>
<body>
  <!-- 1) 인트로 -->
  <div id="introScreen" class="screen active">
    <h1 class="title">디모랑 함께하는 발명 놀이터 ✨</h1>
    <button onclick="startIntro()" class="start-btn">▶ 디모 만나러 가기</button>
    <video autoplay muted loop playsinline webkit-playsinline>
      <source src="dimo.mp4" type="video/mp4">
    </video>
    <!-- 실제 업로드된 인트로 오디오 4개 -->
    <audio id="introAudio1" src="디모 인트로 인사.mp3" preload="auto"></audio>
    <audio id="introAudio2" src="디모인사01.mp3" preload="auto"></audio>
    <audio id="introAudio3" src="디모인사02.mp3" preload="auto"></audio>
    <audio id="introAudio4" src="디모인사03.mp3" preload="auto"></audio>
  </div>

  <!-- 2) 설문 -->
  <div id="formScreen" class="screen">
    <h2 class="section-title">📣 디모에게 알려줘</h2>
    <form id="ideaForm">
      <div class="form-group">
        <label>별명 *</label>
        <input type="text" id="nickname" required>
      </div>
      <div class="form-group">
        <label>내 발명품 이름 *</label>
        <input type="text" id="ideaName" required>
      </div>
      <div class="form-group">
        <label>발명 설명 *</label>
        <textarea id="ideaDetail" required></textarea>
      </div>
      <button type="submit" class="start-btn">디모에게 보내기</button>
    </form>
  </div>

  <!-- 3) 결과 -->
  <div id="resultScreen" class="screen">
    <video autoplay muted loop playsinline webkit-playsinline>
      <source src="dimo.mp4" type="video/mp4">
    </video>
    <div id="celebrationArea" class="celebration-card">
      <h2 class="banner">🎉 축하해요! 나만의 아이디어 카드 🎉</h2>
      <div class="card-body">
        <img id="dimoImage" src="" alt="디모 캐릭터" class="dimo-left">
        <div class="ratings-wrap">
          <div class="rating"><h3>반짝이는 상상력</h3><div id="creativity" class="stars"></div></div>
          <div class="rating"><h3>정말 될까? 점수</h3><div id="feasibility" class="stars"></div></div>
          <div class="rating"><h3>디모의 기술력 레벨</h3><div id="technical" class="stars"></div></div>
        </div>
      </div>
      <div id="ideaInfo" class="idea-info">
        👤 <strong>발명자:</strong> <span id="inventorName"></span> | 💡 <strong>내 발명품:</strong> <span id="ideaDisplay"></span>
      </div>
      <div class="card-footer-logo">DIMO UNIVERSE</div>
      <div id="stampArea"></div>
    </div>
    <button id="shareBtn" class="start-btn">🎨 카드 저장하기</button>
  </div>

  <!-- 칭찬 오디오 (실제 업로드된 3개만 적용) -->
  <audio id="compliment1" src="디모칭찬01.mp3" preload="auto"></audio>
  <audio id="compliment2" src="디모칭찬02.mp3" preload="auto"></audio>
  <audio id="compliment3" src="디모 칭찬 메시지.mp3" preload="auto"></audio>

  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script>
    const dimoImages = ["dimo01.png","dimo02.png","dimo03.png","dimo04.png"];
    const introAudios = [
      document.getElementById("introAudio1"),
      document.getElementById("introAudio2"),
      document.getElementById("introAudio3"),
      document.getElementById("introAudio4")
    ];
    const complimentAudios = [
      document.getElementById("compliment1"),
      document.getElementById("compliment2"),
      document.getElementById("compliment3")
    ];

    // 인트로 랜덤 재생
    function startIntro(){
      document.getElementById("introScreen").classList.remove("active"); 
      document.getElementById("formScreen").classList.add("active"); 
      const audio = introAudios[Math.floor(Math.random()*introAudios.length)];
      audio.play().catch(()=>{});
    }

    function showResult(){
      document.getElementById("formScreen").classList.remove("active");
      document.getElementById("resultScreen").classList.add("active");

      const randomImg = dimoImages[Math.floor(Math.random()*dimoImages.length)];
      document.getElementById("dimoImage").src = randomImg;
      document.getElementById("inventorName").innerText = document.getElementById("nickname").value;
      document.getElementById("ideaDisplay").innerText = document.getElementById("ideaName").value;

      // 별점 랜덤
      ["creativity","feasibility","technical"].forEach(id=>renderRandomStars(id));

      // confetti
      fireConfetti(2000);

      // 칭찬 오디오
      const compliment = complimentAudios[Math.floor(Math.random()*complimentAudios.length)];
      compliment.play().catch(()=>{});

      // 스탬프
      setTimeout(()=>{
        const stampArea = document.getElementById("stampArea");
        const card = document.getElementById("celebrationArea");
        const detail = document.getElementById("ideaDetail").value || "";
        const pureLen = detail.replace(/\s/g, "").length;
        if (pureLen >= 30) {
          stampArea.innerHTML = `<img src="디모스탬프01.png" alt="스탬프" style="position:absolute;right:20px;top:20px;width:120px;">`;
        } else {
          stampArea.innerHTML = "";
        }
      },2000);
    }

    function renderRandomStars(id){
      const el=document.getElementById(id);
      let score = (Math.floor((Math.random() * ((5-3.5)*2+1)) + 7) / 2);
      let html="";
      for(let i=1;i<=5;i++){
        if(score >= i){ html += "<span class='star full'>★</span>"; }
        else if(score >= i-0.5){ html += "<span class='star half'>★</span>"; }
        else { html += "<span class='star'>★</span>"; }
      }
      el.innerHTML = html;
    }

    function fireConfetti(duration=2000){ 
      const end=Date.now()+duration; 
      (function frame(){ 
        confetti({particleCount:5,startVelocity:30,spread:360,origin:{x:Math.random(),y:Math.random()-0.2}}); 
        if(Date.now()<end) requestAnimationFrame(frame); 
      })(); 
    }

    // 카드 저장
    document.getElementById("shareBtn").addEventListener("click", function(){
      const card = document.getElementById("celebrationArea");
      html2canvas(card, { scale: window.devicePixelRatio || 1 }).then(canvas => {
        const link=document.createElement("a");
        link.href=canvas.toDataURL("image/png");
        link.download="dimo_card.png";
        link.click();
      });
    });

    document.getElementById("ideaForm").addEventListener("submit", function(e){ 
      e.preventDefault(); 
      showResult(); 
    });
  </script>
</body>
</html>
